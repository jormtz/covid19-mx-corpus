---
title: "Corpus Covid19-MX"
output: html_notebook
---

Paquetes:

```{R}
library(tidyverse)
library(rvest)
library(selectr)
library(xml2)
```

Direcciones URL con las conferencias. Parece que no hubo conferencia el 7 o el 8 de marzo de 2020. Conferencias hasta el 12 de abril.

```{r}
url_conferencias <- c("https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-secretaria-de-salud-informe-diario-sobre-coronavirus-covid-19-en-mexico?idiom=es",
  "https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-covid-19-en-mexico-secretaria-de-salud?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-covid-19-en-mexico-secretaria-de-salud-236389?idiom=es", "https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud-236648?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud-236726?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud-236979?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud-236995?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-informe-diario-sobre-coronavirus-covid-19-en-mexico-secretaria-de-salud-237135?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237500?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237799?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237932?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237955?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237970?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-237991?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238145?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238381?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238467?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238640?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238671?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238712?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238806?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238857?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-238974?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239067?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239144?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239159?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239175?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239280?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239407?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239541?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239626?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239712?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239735?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239743?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239818?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-239987?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240054?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240119?idiom=es",
"https://www.gob.mx/presidencia/es/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240164?idiom=es",
"https://www.gob.mx/presidencia/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240181?idiom=es",
"https://www.gob.mx/presidencia/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240239?idiom=es",
"https://www.gob.mx/presidencia/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240295?idiom=es",
"https://www.gob.mx/presidencia/articulos/version-estenografica-conferencia-de-prensa-informe-diario-sobre-coronavirus-covid-19-en-mexico-240384?idiom=es"
)

```

Funciones y directorio para el corpus...

```{R}
dame_fecha <- function(pagina){
#Obtiene la fecha del documento y la devuelve en formato YYYY-MM-DD
  fecha <- html_nodes(pagina, ".border-box") %>% 
  html_nodes("dd") %>% 
  html_text() %>% 
  paste0(collapse = " ") %>% 
  str_replace("Presidencia de la República  ", "") %>% 
  str_replace_all(" de ", " ") %>% 
  as.Date(format="%d %B %Y")
  return(fecha)
}

dame_texto <- function(pagina){
#Obtener texto de la conferencia
  texto <- html_nodes(pagina, ".article-body") %>% 
    html_text() %>% 
    str_replace_all("\r\n\r\n", "\n") %>% 
    str_replace_all("\u200B", "")
  return(texto)
}

dame_archivo <- function(url_doc, directorio_corpus){
#Crea el documento, lo nombra con su fecha y lo coloca en un directorio especificado  
  if (dir.exists(directorio_corpus) == FALSE){
    dir.create(directorio_corpus)
    }
  pagina <- read_html(url_doc)
  fecha <- dame_fecha(pagina)
  texto <- dame_texto(pagina)
  nombre_archivo = str_c(fecha, ".txt")
  archivo <- file(str_c(directorio_corpus, nombre_archivo, sep="/"), encoding= "utf8")
  writeLines(texto, archivo)
  on.exit(close(archivo))
  #gc()
}

```

Armar el corpus (incluye una pausa después de cada archivo descargado):

```{R}


for (direccion in url_conferencias) {
  dame_archivo(direccion, "corpus_simple")
  Sys.sleep(10)
}

```

Expresiones regulares útiles:

```
#Solución simplona para capturar a los interlocutores.
^[A-Z].+:

#Remover los separadores e identificadores finales
---\n \n.*
```